library(tm)
options( java.parameters = "-Xmx4g" )
library(RWeka)

removeMostPunctuation<-function (x) {
    # Assume there are no ASCII 1 or 2 characters.
    x <- gsub("(\\w)-(\\w)", "\\1\1\\2", x)
    x <- gsub("(\\w)'(\\w)", "\\1\2\\2", x)
    x <- gsub("[[:punct:]]+", " ", x)
    x <- gsub("\1", "-", x, fixed = TRUE)
    gsub("\2", "'", x, fixed = TRUE)    
} 
removeDodgy <- function(x) iconv(x, "latin1", "ASCII", sub="")

C <- Corpus(DirSource("/Temp/final/en_US/",mode="text"))

C <- tm_map(C, content_transformer(removeDodgy))
C <- tm_map(C, removeNumbers)      
C <- tm_map(C, content_transformer(removeMostPunctuation)) 
C <- tm_map(C, content_transformer(tolower))   
C <- tm_map(C, stripWhitespace)           

UnigramTokenizer <- function(x) NGramTokenizer(x, Weka_control(min = 1, max = 1,delimiters=' \r\n\t'))
dtm1 <- DocumentTermMatrix(C, control = list(tokenize = UnigramTokenizer))
dtm1 <- removeSparseTerms(dtm1,0.999)
freq1 <- colSums(as.matrix(dtm1))
freq1 <- sort(freq1, decreasing = TRUE)
save(freq1,file="freq1.Rda")
rm(dtm1)
rm(freq1)
gc()

BigramTokenizer <- function(x) NGramTokenizer(x, Weka_control(min = 2, max = 2,delimiters=' \r\n\t'))
dtm2 <- DocumentTermMatrix(C, control = list(tokenize = BigramTokenizer))
dtm2 <- removeSparseTerms(dtm2,0.999)
freq2 <- colSums(as.matrix(dtm2))
freq2 <- sort(freq2, decreasing = TRUE)
save(freq2,file="freq2.Rda")
rm(dtm2)
rm(freq2)
gc()

TrigramTokenizer <- function(x) NGramTokenizer(x, Weka_control(min = 3, max = 3,delimiters=' \r\n\t'))
dtm3 <- DocumentTermMatrix(C, control = list(tokenize = TrigramTokenizer))
dtm3 <- removeSparseTerms(dtm3,0.999)
freq3 <- colSums(as.matrix(dtm3))
freq3 <- sort(freq3, decreasing = TRUE)
save(freq3,file="freq3.Rda")
rm(dtm3)
rm(freq3)
gc()

QuadgramTokenizer <- function(x) NGramTokenizer(x, Weka_control(min = 4, max = 4,delimiters=' \r\n\t'))
dtm4 <- DocumentTermMatrix(C, control = list(tokenize = QuadgramTokenizer))
dtm4 <- removeSparseTerms(dtm4,0.99)
freq4 <- colSums(as.matrix(dtm4))
freq4 <- sort(freq4, decreasing = TRUE)
save(freq4,file="freq4.Rda")
rm(dtm4)
rm(freq4)
gc()
